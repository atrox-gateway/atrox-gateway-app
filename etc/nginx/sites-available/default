# /etc/nginx/sites-available/default

server {
	listen 80 default_server;
	server_name _;

	# Auth endpoints
	location /api/v1/auth/ {
		proxy_pass http://127.0.0.1:3000;
		proxy_set_header Host $host;
	}

	# Admin endpoints
	location /api/v1/admin/ {
		proxy_pass http://127.0.0.1:3001;
		proxy_set_header Host $host;
	}

	# PUN dynamic upstream
	location /api/v1/user/ {
		if ($user_backend = "") {
			return 401 'No Autorizado: Inicie sesi√≥n primero';
		}
		proxy_pass http://$user_backend;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "Upgrade";
		proxy_set_header Host $host;
	}

	# Default proxy / fallback (could be adjusted to serve SPA)
	location / {
		proxy_pass http://127.0.0.1:3000;
		proxy_set_header Host $host;
	}
}